# MyBatis XML方式的基本用法  

+ 特别注意！  
  &emsp;&emsp;由于Java中的基本类型会有默认值，
  例如当某个类中存在private int age;字段时，
  创建了这个类时，age会有默认值0。当使用age属性时，
  它总会有值。因此在某些情况下，便无法实现使age为null。
  并且在动态SQL的部分，如果使用age != null进行判断，
  结果总会为true，因而导致了很多隐藏的问题。  
  &emsp;&emsp;<font color="red">所以，
  在实体类中不要使用基本类型。</font>
  Java八大基本类型分别是:byte,char,int,short,long,float,double,boolean。  


&emsp;&emsp;后面可以通过MyBatis官方提供的工具
MyBatis Generator（MyBatis代码生成器，简称MBG）
根据数据库表的信息自动生成这些类，以减少工作量。也就是常说的逆向工程。
    
## 使用XML方式  
&emsp;&emsp;MyBatis的真正强大之处在于它的映射语句。
由于它的映射语句异常强大，映射器的XML文件就显得相对简单。
&emsp;&emsp;MyBatis 3.0相比2.0版本的一个最大变化，
就是支持使用接口来调用。  
&emsp;&emsp;以前使用SqlSession通过命名空间
调用MyBatis方法时，首先需要用到命名空间和方法id
组成的字符串来调用相应的方法。当参数多于1个的时候，
需要将所有参数放到一个Map对象中。通过Mao传递多个参数，
使用起来很不方便，而且还无法避免很多重复的代码。  
&emsp;&emsp;使用接口调用方式就方便很多，MyBatis使用
Java的动态代理可以直接通过接口来调用相应的方法，
而不需要提供接口的实现类。更不需要在实现类中
使用SqlSession以通过命名空间间接调用。另外，
当有多个参数的时候，通过参数注解@Param设置参数
的名字省去了手动构造Map参数的过程，尤其在
Spring中使用的时候，可以配置为自动扫描所有的接口类，
直接将接口注入要用到的地方。  
    
+ 注意！
  &emsp;&emsp;不要认为使用接口就是使用了MyBatis注解，这两者是不同的。  
  &emsp;&emsp;接口可以配合XML使用，也可以配合注解来使用。
  XML可以单独使用，但是注解必须在接口中使用。
    
## 如何使用MyBatis的XML方式。  
&emsp;&emsp;首先，在src/main/resources下建包tk.mybatis.simple.mapper,
再分别创建数据库表对应的XML文件。然后，在src/main/java下面创建包tk.mybatis.simple.mapper。
接着，在该包下创建XML文件对应的接口类。  

&emsp;&emsp;需要注意的是&lt;mapper>根标签的namespace属性。
当Mapper接口和XML文件关联的时候，命名空间namespace的值就
需要配置成接口的全限定名称，例如UserMapper接口对应的
tk.mybatis.simple.mapper.UserMapper,MyBatis内部
就是通过这个值将接口和XML关联起来的。  

&emsp;&emsp;两种配置方式：  
1. 方式一：
    ```java  
     <!-- 配置一个包含完整类路径的CountryMapper.xml,这是一个MyBatis的SQL语句与映射配置文件-->
    <mappers>
        <!--        这是一个一个的配置-->
        <mapper resource="tk/mybatis/simple/mapper/CountryMapper.xml"></mapper>

    </mappers>
    ```  
   这种方式需要将所有映射文件一一列举出来，如果增加了新的映射文件，
   还需要注意在此处进行配置。
   
2. 方式二：
    ```java  
        <!-- 配置一个包含完整类路径的CountryMapper.xml,这是一个MyBatis的SQL语句与映射配置文件-->
        <mappers>
            <!--        这是单个配置-->
            <!--        <mapper resource="tk/mybatis/simple/mapper/CountryMapper.xml"></mapper>-->
    
            <!--直接使用整个包配置-->
            <package name="tk.mybatis.simple.mapper"/>
        </mappers>
    ```  
   &emsp;&emsp;这种配置方式先会查找tk.mybatis.simple.mapper包下的所有接口，
   循环对接口进行如下操作。  
   1. 判断接口对应的命名看空间是否已经存在，如果存在就抛出异常，不存在就继续进行接下来的操作。  
   2. 加载接口对应的XMl映射文件，将接口全限定名转换为路径，例如，将接口tk.mybatis.simple.mapper.UserMapper
    转换为以.xml为后缀搜索XML资源，如果找到就解析XML。
   3. 处理接口中的注解方法。

## select用法  
&emsp;&emsp;先写一个根据用户id查询用户信息的简单方法。在UserMapper接口中红添加一个selectByID方法。  
```java
/**
 * 通过id查询用户
 * 
 * @param id
 * @return
 */
    SysUser selectById(Long id);
```  
然后在对应的UserMapper.xml中添加如下的&lt;resultMap>和&lt;select>部分的代码。  
    

```java    
    <?xml version="1.0" encoding="UTF-8" ?>
    <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
    <mapper namespace="tk.mybatis.simple.mapper.UserMapper">
        <resultMap id="userMap" type="tk.mybatis.simple.model.SysUser">
            <id property="id" column="id"/>
            <result property="userName" column="user_name"/>
            <result property="userPassword" column="user_password"/>
            <result property="userEmail" column="user_email"/>
            <result property="userInfo" column="user_info"/>
            <result property="headImg" column="head_img" jdbcType="BLOB"/>
            <result property="createTime" column="create_time" jdbcType="TIMESTAMP"/>
        </resultMap>
        <select id="selectAll" resultMap="userMap">
            select id,
                   user_name,
                   user_password,
                   user_email,
                   user_info,
                   head_img,
                   create_time createTime
            from sys_user
        </select>
    </mapper>
```  
&emsp;&emsp;接口和XML是通过将namespace的值设置为接口的全限定名称来进行关联的，那么接口方法和XMl又是怎么关联的呢？  
可以发现，XML中的select标签的id属性值和定义的接口方法名是一样的。通过此种方式将接口方法和SQL语句关联到一起的。
映射XML和接口的命名需要符合如下规则。
+ 当只使用XML而不使用接口的时候，namespace的值可以设置为任意不重复的名称。  
+ 标签的id属性不能有英文句号“.”,并且同一个命名空间下不能出现重复的id。  
+ 因为接口方法是可以重载的，所以接口中可以出现多个同名但参数不同的方法，但是XML中id的值不能重复，
  因而接口中的所有同名方法会对应着XML中的同一个id的方法，最常见的用法就是，同名方法中其中一个方法
  增加一个RowBound类型的参数用于实现分页查询。


&emsp;&emsp;下面在通过UserMapper.xml先来了解下XML中一些标签和属性的作用。  
+ &lt;select>:映射查询语句使用的标签。  
+ id：命名空间中的唯一标识符，可用来代表这条语句。  
+ resultMap：用于设置返回值的类型和映射关系。  
+ select标签中的select * from sys_user where id = #{id}是查询语句。
+ #{id}:MyBatis SQL中使用预编译参数的一种方式，大括号中的id是传入的参数名。
  
这里的userMap就是
  上面&lt;resultMap>中的id属性值，通过id引用需要的&lt;resultMap>。
+ 